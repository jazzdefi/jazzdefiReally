{"ast":null,"code":"import poolsConfig from \"config/constants/pools\";\nimport masterChefABI from \"config/abi/masterchef.json\";\nimport sousChefABI from \"config/abi/sousChef.json\";\nimport erc20ABI from \"config/abi/erc20.json\";\nimport multicall from \"utils/multicall\";\nimport { getAddress, getMasterChefAddress } from \"utils/addressHelpers\";\nimport { getWeb3NoAccount } from \"utils/web3\";\nimport BigNumber from \"bignumber.js\"; // Pool 0, Cake / Cake is a different kind of contract (master chef)\n// BNB pools use the native BNB token (wrapping ? unwrapping is done at the contract level)\n\nconst nonBnbPools = poolsConfig.filter(p => p.stakingToken.symbol !== \"BNB\");\nconst bnbPools = poolsConfig.filter(p => p.stakingToken.symbol === \"BNB\");\nconst nonMasterPools = poolsConfig.filter(p => p.sousId !== 0);\nconst web3 = getWeb3NoAccount();\nconst masterChefContract = new web3.eth.Contract(masterChefABI, getMasterChefAddress());\nexport const fetchPoolsAllowance = async account => {\n  const calls = nonBnbPools.map(p => ({\n    address: getAddress(p.stakingToken.address),\n    name: \"allowance\",\n    params: [account, getAddress(p.contractAddress)]\n  }));\n  const allowances = await multicall(erc20ABI, calls);\n  return nonBnbPools.reduce((acc, pool, index) => ({ ...acc,\n    [pool.sousId]: new BigNumber(allowances[index]).toJSON()\n  }), {});\n};\nexport const fetchUserBalances = async account => {\n  // Non BNB pools\n  const calls = nonBnbPools.map(p => ({\n    address: getAddress(p.stakingToken.address),\n    name: \"balanceOf\",\n    params: [account]\n  }));\n  const tokenBalancesRaw = await multicall(erc20ABI, calls);\n  const tokenBalances = nonBnbPools.reduce((acc, pool, index) => ({ ...acc,\n    [pool.sousId]: new BigNumber(tokenBalancesRaw[index]).toJSON()\n  }), {}); // BNB pools\n\n  const bnbBalance = await web3.eth.getBalance(account);\n  const bnbBalances = bnbPools.reduce((acc, pool) => ({ ...acc,\n    [pool.sousId]: new BigNumber(bnbBalance).toJSON()\n  }), {});\n  return { ...tokenBalances,\n    ...bnbBalances\n  };\n};\nexport const fetchUserStakeBalances = async account => {\n  const calls = nonMasterPools.map(p => ({\n    address: getAddress(p.contractAddress),\n    name: \"userInfo\",\n    params: [account]\n  }));\n  const userInfo = await multicall(sousChefABI, calls);\n  const stakedBalances = nonMasterPools.reduce((acc, pool, index) => ({ ...acc,\n    [pool.sousId]: new BigNumber(userInfo[index].amount._hex).toJSON()\n  }), {}); // Cake / Cake pool\n\n  const {\n    amount: masterPoolAmount\n  } = await masterChefContract.methods.userInfo(\"0\", account).call();\n  return { ...stakedBalances,\n    0: new BigNumber(masterPoolAmount).toJSON()\n  };\n};\nexport const fetchUserPendingRewards = async account => {\n  const calls = nonMasterPools.map(p => ({\n    address: getAddress(p.contractAddress),\n    name: \"pendingReward\",\n    params: [account]\n  }));\n  const res = await multicall(sousChefABI, calls);\n  const pendingRewards = nonMasterPools.reduce((acc, pool, index) => ({ ...acc,\n    [pool.sousId]: new BigNumber(res[index]).toJSON()\n  }), {}); // Cake / Cake pool\n\n  const pendingReward = await masterChefContract.methods.pendingPiano(\"0\", account).call();\n  return { ...pendingRewards,\n    0: new BigNumber(pendingReward).toJSON()\n  };\n};","map":{"version":3,"sources":["/home/drab/Documents/jazzdefi/src/state/pools/fetchPoolsUser.ts"],"names":["poolsConfig","masterChefABI","sousChefABI","erc20ABI","multicall","getAddress","getMasterChefAddress","getWeb3NoAccount","BigNumber","nonBnbPools","filter","p","stakingToken","symbol","bnbPools","nonMasterPools","sousId","web3","masterChefContract","eth","Contract","fetchPoolsAllowance","account","calls","map","address","name","params","contractAddress","allowances","reduce","acc","pool","index","toJSON","fetchUserBalances","tokenBalancesRaw","tokenBalances","bnbBalance","getBalance","bnbBalances","fetchUserStakeBalances","userInfo","stakedBalances","amount","_hex","masterPoolAmount","methods","call","fetchUserPendingRewards","res","pendingRewards","pendingReward","pendingPiano"],"mappings":"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","sourcesContent":["import { AbiItem } from \"web3-utils\";\nimport poolsConfig from \"config/constants/pools\";\nimport masterChefABI from \"config/abi/masterchef.json\";\nimport sousChefABI from \"config/abi/sousChef.json\";\nimport erc20ABI from \"config/abi/erc20.json\";\nimport multicall from \"utils/multicall\";\nimport { getAddress, getMasterChefAddress } from \"utils/addressHelpers\";\nimport { getWeb3NoAccount } from \"utils/web3\";\nimport BigNumber from \"bignumber.js\";\n\n// Pool 0, Cake / Cake is a different kind of contract (master chef)\n// BNB pools use the native BNB token (wrapping ? unwrapping is done at the contract level)\nconst nonBnbPools = poolsConfig.filter((p) => p.stakingToken.symbol !== \"BNB\");\nconst bnbPools = poolsConfig.filter((p) => p.stakingToken.symbol === \"BNB\");\nconst nonMasterPools = poolsConfig.filter((p) => p.sousId !== 0);\nconst web3 = getWeb3NoAccount();\nconst masterChefContract = new web3.eth.Contract(\n  (masterChefABI as unknown) as AbiItem,\n  getMasterChefAddress()\n);\n\nexport const fetchPoolsAllowance = async (account) => {\n  const calls = nonBnbPools.map((p) => ({\n    address: getAddress(p.stakingToken.address),\n    name: \"allowance\",\n    params: [account, getAddress(p.contractAddress)],\n  }));\n\n  const allowances = await multicall(erc20ABI, calls);\n  return nonBnbPools.reduce(\n    (acc, pool, index) => ({\n      ...acc,\n      [pool.sousId]: new BigNumber(allowances[index]).toJSON(),\n    }),\n    {}\n  );\n};\n\nexport const fetchUserBalances = async (account) => {\n  // Non BNB pools\n  const calls = nonBnbPools.map((p) => ({\n    address: getAddress(p.stakingToken.address),\n    name: \"balanceOf\",\n    params: [account],\n  }));\n  const tokenBalancesRaw = await multicall(erc20ABI, calls);\n  const tokenBalances = nonBnbPools.reduce(\n    (acc, pool, index) => ({\n      ...acc,\n      [pool.sousId]: new BigNumber(tokenBalancesRaw[index]).toJSON(),\n    }),\n    {}\n  );\n\n  // BNB pools\n  const bnbBalance = await web3.eth.getBalance(account);\n  const bnbBalances = bnbPools.reduce(\n    (acc, pool) => ({\n      ...acc,\n      [pool.sousId]: new BigNumber(bnbBalance).toJSON(),\n    }),\n    {}\n  );\n\n  return { ...tokenBalances, ...bnbBalances };\n};\n\nexport const fetchUserStakeBalances = async (account) => {\n  const calls = nonMasterPools.map((p) => ({\n    address: getAddress(p.contractAddress),\n    name: \"userInfo\",\n    params: [account],\n  }));\n  const userInfo = await multicall(sousChefABI, calls);\n  const stakedBalances = nonMasterPools.reduce(\n    (acc, pool, index) => ({\n      ...acc,\n      [pool.sousId]: new BigNumber(userInfo[index].amount._hex).toJSON(),\n    }),\n    {}\n  );\n\n  // Cake / Cake pool\n  const {\n    amount: masterPoolAmount,\n  } = await masterChefContract.methods.userInfo(\"0\", account).call();\n\n  return { ...stakedBalances, 0: new BigNumber(masterPoolAmount).toJSON() };\n};\n\nexport const fetchUserPendingRewards = async (account) => {\n  const calls = nonMasterPools.map((p) => ({\n    address: getAddress(p.contractAddress),\n    name: \"pendingReward\",\n    params: [account],\n  }));\n  const res = await multicall(sousChefABI, calls);\n  const pendingRewards = nonMasterPools.reduce(\n    (acc, pool, index) => ({\n      ...acc,\n      [pool.sousId]: new BigNumber(res[index]).toJSON(),\n    }),\n    {}\n  );\n\n  // Cake / Cake pool\n  const pendingReward = await masterChefContract.methods\n    .pendingPiano(\"0\", account)\n    .call();\n\n  return { ...pendingRewards, 0: new BigNumber(pendingReward).toJSON() };\n};\n"]},"metadata":{},"sourceType":"module"}